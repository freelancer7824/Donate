<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>রক্তদান - লগইন / সাইনআপ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; font-family: 'Noto Sans Bengali', sans-serif; }
  body { background: #ffe6e6; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
  .container { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 25px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
  h2 { text-align: center; margin-bottom: 20px; color: #d32f2f; }
  form { display: flex; flex-direction: column; }
  input, select { margin-bottom: 15px; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
  input:focus, select:focus { outline: none; border-color: #d32f2f; box-shadow: 0 0 5px rgba(211, 47, 47, 0.3); }
  button { padding: 12px; background-color: #d32f2f; color: #fff; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: 0.3s; }
  button:hover { background-color: #b71c1c; }
  .toggle-link { text-align: center; margin-top: 15px; font-size: 14px; }
  .toggle-link a { color: #d32f2f; text-decoration: none; }
  .toggle-link a:hover { text-decoration: underline; }
  .selected-display { margin-bottom: 10px; font-weight: 500; color: #333; }
</style>
</head>
<body>

<!-- ================== LOGIN ================== -->
<div class="container" id="login-container">
  <h2>রক্তদান - লগইন</h2>
  <form id="loginForm">
    <input type="text" id="loginId" placeholder="ফোন নম্বর অথবা ইমেইল" required>
    <input type="password" id="loginPassword" placeholder="পাসওয়ার্ড" required>
    <button type="submit">লগইন</button>
  </form>
  <div class="toggle-link">
    একাউন্ট নেই? <a href="#" onclick="toggleForms()">সাইনআপ করুন</a>
  </div>
</div>

<!-- ================== SIGNUP ================== -->
<div class="container" id="signup-container" style="display:none;">
  <h2>রক্তদান - সাইনআপ</h2>
  <form id="signupForm">
    <input type="text" id="fullname" placeholder="পুরো নাম" required>
    <input type="number" id="age" placeholder="বয়স (১৮-৭০)" min="18" max="70" required>

    <div class="selected-display" id="selectedDistrict">নির্বাচিত জেলা: নেই</div>
    <select id="jela" required>
      <option value="">জেলা নির্বাচন করুন</option>
    </select>

    <div class="selected-display" id="selectedUpazila">নির্বাচিত উপজেলা: নেই</div>
    <select id="upojela" required>
      <option value="">উপজেলা নির্বাচন করুন</option>
    </select>

    <select id="bloodGroup" required>
      <option value="">রক্তের গ্রুপ নির্বাচন করুন</option>
      <option value="A+">A+</option>
      <option value="A-">A-</option>
      <option value="B+">B+</option>
      <option value="B-">B-</option>
      <option value="O+">O+</option>
      <option value="O-">O-</option>
      <option value="AB+">AB+</option>
      <option value="AB-">AB-</option>
    </select>

    <input type="text" id="phone" placeholder="ফোন নম্বর" required>
    <input type="email" id="email" placeholder="ইমেইল (ঐচ্ছিক)">
    <input type="password" id="password" placeholder="পাসওয়ার্ড" required>
    <input type="password" id="confirmPassword" placeholder="পাসওয়ার্ড নিশ্চিত করুন" required>
    <button type="submit">সাইনআপ</button>
  </form>
  <div class="toggle-link">
    ইতিমধ্যে একাউন্ট আছে? <a href="#" onclick="toggleForms()">লগইন করুন</a>
  </div>
</div>

<!-- ================== FIREBASE ================== -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAqhLfmOfmP-_8DOcoEH7Ck7fMF9Id4vJ4",
  authDomain: "earn-project-5f892.firebaseapp.com",
  databaseURL: "https://earn-project-5f892-default-rtdb.firebaseio.com/",
  projectId: "earn-project-5f892",
  storageBucket: "earn-project-5f892.firebasestorage.app",
  messagingSenderId: "8457886057",
  appId: "1:8457886057:web:b5e01d0972d169f47085f8"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// ================== FORM TOGGLE ==================
const signupContainer = document.getElementById('signup-container');
const loginContainer = document.getElementById('login-container');
function toggleForms(){
  signupContainer.style.display = signupContainer.style.display === 'none' ? 'block' : 'none';
  loginContainer.style.display = loginContainer.style.display === 'none' ? 'block' : 'none';
}

// ================== DISTRICT & UPAZILA DATA ==================
const upoData = {
  "ঢাকা": ["ঢাকা সদর", "ফরিদপুর", "গাজীপুর", "গোপালগঞ্জ", "কিশোরগঞ্জ", "মাদারীপুর", "মানিকগঞ্জ", "নরসিংদী", "রাজবাড়ী", "শরীয়তপুর", "টাঙ্গাইল"],
  "চট্টগ্রাম": ["চট্টগ্রাম সদর", "কক্সবাজার", "কুমিল্লা", "ফেনী", "ব্রাহ্মণবাড়ীয়া", "নোয়াখালী", "রাঙ্গামাটি", "খাগড়াছড়ি", "বান্দরবান", "লক্ষ্মীপুর"],
  "খুলনা": ["খুলনা সদর", "যশোর", "সাতক্ষীরা", "বাগেরহাট", "চুয়াডাঙ্গা", "মেহেরপুর", "নড়াইল", "কুষ্টিয়া", "মাগুরা", "ঝিনাইদহ"],
  "রাজশাহী": ["রাজশাহী সদর", "বগুড়া", "জয়পুরহাট", "নওগাঁ", "নাটোর", "চাপাইনবাবগঞ্জ", "পাবনা", "সিরাজগঞ্জ"],
  "বরিশাল": ["বরিশাল সদর", "বরগুনা", "ভোলা", "ঝালকাঠি", "পটুয়াখালী", "পিরোজপুর"],
  "সিলেট": ["সিলেট সদর", "মৌলভীবাজার", "হবিগঞ্জ", "সুনামগঞ্জ"],
  "রংপুর": ["রংপুর সদর", "দিনাজপুর", "ঠাকুরগাঁও", "পঞ্চগড়", "কুড়িগ্রাম", "লালমনিরহাট", "নীলফামারী", "গাইবান্ধা"],
  "ময়মনসিংহ": ["ময়মনসিংহ সদর", "জামালপুর", "নেত্রকোনা", "শেরপুর"]
};

const jelaSelect = document.getElementById('jela');
const upojelaSelect = document.getElementById('upojela');
const selectedDistrict = document.getElementById('selectedDistrict');
const selectedUpazila = document.getElementById('selectedUpazila');

for(let jela in upoData){
  const opt = document.createElement('option');
  opt.value = jela;
  opt.textContent = jela;
  jelaSelect.appendChild(opt);
}

jelaSelect.addEventListener('change', function(){
  const jela = this.value;
  selectedDistrict.textContent = "নির্বাচিত জেলা: " + (jela || "নেই");
  upojelaSelect.innerHTML = '<option value="">উপজেলা নির্বাচন করুন</option>';
  if(jela && upoData[jela]){
    upoData[jela].forEach(u=>{
      const opt = document.createElement('option');
      opt.value = u;
      opt.textContent = u;
      upojelaSelect.appendChild(opt);
    });
  }
  selectedUpazila.textContent = "নির্বাচিত উপজেলা: নেই";
});

upojelaSelect.addEventListener('change', function(){
  selectedUpazila.textContent = "নির্বাচিত উপজেলা: " + (this.value || "নেই");
});

// ================== SIGNUP ==================
document.getElementById('signupForm').addEventListener('submit', function(e){
  e.preventDefault();
  const fullname = document.getElementById('fullname').value;
  const age = document.getElementById('age').value;
  const district = jelaSelect.value;
  const upazila = upojelaSelect.value;
  const bloodGroup = document.getElementById('bloodGroup').value;
  const phone = document.getElementById('phone').value;
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;

  if(password !== confirmPassword){
    alert("পাসওয়ার্ড মেলেনি!");
    return;
  }

  firebase.database().ref('donors').get().then(snapshot => {
    const users = snapshot.exists() ? snapshot.val() : {};
    for(let key in users){
      if(users[key].phone === phone){
        alert("এই ফোন নম্বর ইতিমধ্যে ব্যবহৃত হয়েছে!");
        return;
      }
      if(email && users[key].email === email){
        alert("এই ইমেইল ইতিমধ্যে ব্যবহৃত হয়েছে!");
        return;
      }
    }

    const userId = phone;
    firebase.database().ref('donors/' + userId).set({
      fullname, age, district, upazila, bloodGroup, phone, email, password
    }).then(()=>{
      alert("সাইনআপ সফল! এখন লগইন করুন।");
      this.reset();
      selectedDistrict.textContent = "নির্বাচিত জেলা: নেই";
      selectedUpazila.textContent = "নির্বাচিত উপজেলা: নেই";
      toggleForms();
      document.getElementById('loginId').value = phone;
    }).catch(err=>{
      console.error(err);
      alert("ডাটা সেভ করতে সমস্যা: " + err.message);
    });

  }).catch(err=>{
    console.error(err);
    alert("ত্রুটি: " + err.message);
  });
});

// ================== LOGIN ==================
document.getElementById('loginForm').addEventListener('submit', function(e){
  e.preventDefault();
  const loginId = document.getElementById('loginId').value;
  const password = document.getElementById('loginPassword').value;

  firebase.database().ref('donors').get().then(snapshot => {
    if(snapshot.exists()){
      const users = snapshot.val();
      let foundUser = null;

      for(let key in users){
        if(users[key].phone === loginId || users[key].email === loginId){
          foundUser = users[key];
          break;
        }
      }

      if(foundUser){
        if(foundUser.password === password){
          alert("লগইন সফল!");
          localStorage.setItem('donorData', JSON.stringify(foundUser));
          window.location.href = "dashboard.html";
        } else {
          alert("পাসওয়ার্ড ভুল!");
        }
      } else {
        alert("ইউজার পাওয়া যায়নি!");
      }
    } else {
      alert("কোনো ইউজার ডাটা নেই!");
    }
  }).catch(err=>{
    console.error(err);
    alert("ত্রুটি: " + err.message);
  });
});

// ================== AUTO REDIRECT IF ALREADY LOGGED IN ==================
window.addEventListener('load', ()=>{
  if(localStorage.getItem('donorData')){
    window.location.href = "dashboard.html";
  }
});
</script>
</body>
</html>